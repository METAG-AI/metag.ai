import{r as e}from"./request-6150d4f8.js";import{B as t}from"./BaseUrl-9fb7060e.js";import{y as r}from"./index-d981ad22.js";const n=e=>{const t=new TextDecoder("utf-8").decode(e);let r={};return r=t.indexOf("}{")>-1?(e=>{const t=e.replaceAll("}{","},{"),r=JSON.parse("["+t+"]");let n={response:"",task_ids:[],remark:""};return r.forEach(((e,t,r)=>{e.response&&(n.response+=e.response),e.task_ids&&(n.task_ids+=e.task_ids),e.remark&&(n.remark+=e.remark)})),n})(t):JSON.parse(t),r};function s(e,s,o){const a=new AbortController;function i(e){return e.read().then((t=>{if(t.done)return!0;const r=n(t.value),a=r.response||"";let c=a;if(!!/[\u4e00-\u9fa5]/.test(a)&&(c=a.replace(/[\u4e00-\u9fa5]/g," ")),s(c,r),r.task_ids&&r.task_ids.length>0){let e;return e=r.task_ids&&r.task_ids.length>0?r.task_ids[0]:r.task_ids,o(e,r),!0}return i(e)}))}return fetch(t.metag+"/api/thread/completions",{method:"POST",headers:{"Content-Type":"application/json","M-API-KEY":r.info.token},body:JSON.stringify(e),signal:a.signal}).then((e=>i(e.body.getReader()))).catch((function(e){return e}))}function o(t){return e.get(`/api/thread/list/${t}`,{})}function a(e,n){const s=new AbortController;function o(e){return e.read().then((t=>{if(t.done)return!0;const r=new TextDecoder("utf-8").decode(t.value);n(r);return Math.floor(Number(r))<0&&s.abort(),o(e)}))}return fetch(t.metag+"/api/general/progress/"+e,{signal:s.signal,headers:{"Content-Type":"application/json","M-API-KEY":r.info.token}}).then((e=>o(e.body.getReader()))).catch((function(e){return e}))}function i(t){return e.get(`/api/project/resource/${t}`,{})}export{a,i as b,s as c,o as g};
