import{r as e,b as t,a as i,j as s,F as a,H as l}from"./index-d981ad22.js";import{g as o,a as r,c as n,b as c,d,e as h,f as m}from"./project-28ffe350.js";import{o as p,u as g}from"./index-946e0a4e.js";import{B as u,a as _}from"./index-5f568926.js";import{i as f,M as y,S as C,g as x}from"./info2-470ac738.js";import{f as v}from"./formatDate-e3431c7a.js";import{L as b,E as N}from"./index-3c101bd2.js";import{B as j}from"./BaseUrl-9fb7060e.js";import{b as P}from"./thread-10bf4821.js";import{I as w}from"./index-63d26495.js";import{S as D}from"./add-4cd0684f.js";import{P as k}from"./progress-05a49807.js";import{m as E}from"./index-a374cbea.js";import"./request-6150d4f8.js";import"./index-f246fd73.js";import"./index-9f063626.js";import"./toConsumableArray-6b865d6a.js";import"./render-d35390e1.js";import"./index-ef3c26e4.js";import"./zoom-84b4ec7e.js";import"./useLayoutEffect-54d4d64e.js";import"./useMergedState-2aa398f6.js";import"./Compact-f7c979a2.js";import"./KeyCode-073d009d.js";const M="_header_1pyuy_1",L="_title_1pyuy_10",I="_btn-create_1pyuy_24",B="_create_1pyuy_37",V="_content_1pyuy_54",$="_stateTitle_1pyuy_65",R="_numberTitle_1pyuy_75",S="_card-list_1pyuy_85",T="_item_1pyuy_88",U="_preview_1pyuy_103",A="_bottom_1pyuy_127",F="_export-list_1pyuy_155",H="_export-status_1pyuy_166",O="_export-name_1pyuy_177",z="_input-box_1pyuy_222",W="_btn_1pyuy_16",Z="_empty_1pyuy_254",J="_menu__box_8b6ma_1",K="_menu__darkitem_8b6ma_25",X=i=>{const{x:s,y:a,visible:l,items:o,style:r,onMaskClick:n,onMenuClick:c}=i,d=e.useRef(null);e.useEffect((()=>{if(l){const{offsetWidth:e,offsetHeight:t}=d.current,i=20,l=e/2;let o=s-l,r=a;o-l<=0?o=0:o+e>=innerWidth-i&&(o=innerWidth-e-i),r+t>=innerHeight-i&&(r=innerHeight-t-i),d.current.style.left=o+"px",d.current.style.top=r+"px"}}),[l]);const h=e.useCallback((e=>{null==c||c(e)}),[o]);return t(f,{visible:l,onClick:n,children:t("div",{ref:d,className:J,style:r,children:o.map(((e,i)=>t("div",{className:K,onClick:()=>h(e.value),children:e.label},i)))})})};function q(t){return e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",fill:"none",width:14,height:14,viewBox:"0 0 14 14",...t},e.createElement("defs",null,e.createElement("clipPath",{id:"master_svg0_4547_18703"},e.createElement("rect",{x:0,y:0,width:14,height:14,rx:0}))),e.createElement("g",{style:{mixBlendMode:"passthrough"},clipPath:"url(#master_svg0_4547_18703)"},e.createElement("g",{style:{mixBlendMode:"passthrough"}},e.createElement("path",{d:"M1.75,7.0000440234375C1.75,6.3557080234375,2.272334,5.8333740234375,2.91667,5.8333740234375C3.561,5.8333740234375,4.08333,6.3557080234375,4.08333,7.0000440234375C4.08333,7.6443740234375,3.561,8.1667040234375,2.91667,8.1667040234375C2.272334,8.1667040234375,1.75,7.6443740234375,1.75,7.0000440234375C1.75,7.0000440234375,1.75,7.0000440234375,1.75,7.0000440234375ZM5.83333,7.0000440234375C5.83333,6.3557080234375,6.35567,5.8333740234375,7,5.8333740234375C7.64435,5.8333740234375,8.16667,6.3557080234375,8.16667,7.0000440234375C8.16667,7.6443740234375,7.64435,8.1667040234375,7,8.1667040234375C6.35567,8.1667040234375,5.83333,7.6443740234375,5.83333,7.0000440234375C5.83333,7.0000440234375,5.83333,7.0000440234375,5.83333,7.0000440234375ZM9.91667,7.0000440234375C9.91667,6.3557080234375,10.43898,5.8333740234375,11.08333,5.8333740234375C11.72768,5.8333740234375,12.25,6.3557080234375,12.25,7.0000440234375C12.25,7.6443740234375,11.72768,8.1667040234375,11.08333,8.1667040234375C10.43898,8.1667040234375,9.91667,7.6443740234375,9.91667,7.0000440234375C9.91667,7.0000440234375,9.91667,7.0000440234375,9.91667,7.0000440234375Z",fillRule:"evenodd",fill:"#B3BBC7",fillOpacity:1}))))}const G=p((()=>{const p=i(),f=g((()=>({loading:!1,loadingComplete:!1,delLoading:!1,createLoading:!1,changeLoading:!1,items:[],exports:[],isProgress:!0,menuItems:[],processItems:[{label:"Rename",value:"rename"},{label:"Delete",value:"delete"}],downItems:[{label:"Rename",value:"rename"},{label:"Download",value:"download"},{label:"Delete",value:"delete"}],actionItem:null,delVisible:!1,createVisible:!1,changeVisible:!1,projectName:"",menuDialog:{x:0,y:0,visible:!1},async fetchProgressList(){this.loading=!0;const e=await o({limit:100,page:1});l((()=>{this.loadingComplete=!0,this.loading=!1,this.items=e}))},failedPrompt(){E.error("Export failed")},getFilePath(e,t){P(t).then((t=>{l((()=>{t&&t.length>0&&(e.resource=t[0].url,e.thumbnail=t[0].meta.thumbnail)}))})).catch((()=>{this.failedPrompt()})).finally((()=>{l((()=>e.loading=!1))}))},getExportProgress(e,t){e.loading=!0,e.percent=0,e.resource="",x(t,(t=>{l((()=>e.percent=t))})).then((i=>{"success"===i?this.getFilePath(e,t):(l((()=>e.loading=!1)),this.failedPrompt())})).catch((()=>{l((()=>e.loading=!1)),this.failedPrompt()}))},async fetchExportList(){const e=await r({limit:100,page:1});l((()=>{this.exports=e})),this.exports.forEach((e=>{"progress"===e.status&&this.getExportProgress(e,e.task_id)}))},async fetchList(){this.loading=!0,this.fetchProgressList(),this.fetchExportList()},async createProject(){this.createLoading=!0;const e=await n({title:this.projectName||"Unnamed"});l((()=>{this.createLoading=!1})),this.closeCreateDialog(),(null==e?void 0:e.pid)&&p(`/editor?pid=${e.pid}&title=${e.title}`)},async changeProject(){this.changeLoading=!0,this.isProgress?(await c({pid:this.actionItem.pid,title:this.projectName||"Unnamed"}),this.fetchProgressList()):(await d({export_id:this.actionItem.export_id,title:this.projectName||"Unnamed"}),this.fetchExportList()),l((()=>{this.changeLoading=!1})),this.closeChangeDialog()},projectNameChange(e){this.projectName=e.target.value},closeDelDialog(){this.delVisible=!1},openCreateDialog(){this.projectName="",this.createVisible=!0},closeCreateDialog(){this.createVisible=!1},openChangeDialog(){this.changeVisible=!0},closeChangeDialog(){this.changeVisible=!1},async handlerDel(){if(this.delLoading=!0,this.isProgress){"successed"===(await h(this.actionItem.pid)).status&&this.fetchProgressList()}else{"successed"===(await m({export_id:this.actionItem.export_id})).status&&this.fetchExportList()}l((()=>{this.delLoading=!1})),this.closeDelDialog()},openMenu(e,t){e.stopPropagation(),this.actionItem=t,f.menuDialog={x:e.clientX,y:e.clientY,visible:!0}},openProcessMenu(e,t){e.stopPropagation(),this.menuItems=[...this.processItems],this.isProgress=!0,this.openMenu(e,t)},openExportMenu(e,t){e.stopPropagation(),this.menuItems=[...this.downItems],this.isProgress=!1,this.openMenu(e,t)},goToProview(e){p(`/main/preview?eid=${e.export_id}`),window.localStorage.setItem("curExported",JSON.stringify(e))},handlerMenuClick(e){switch(e){case"delete":this.delVisible=!0;break;case"share":break;case"rename":this.projectName=this.isProgress?this.actionItem.title:this.actionItem.name,this.changeVisible=!0;break;case"download":const e=document.createElement("a");e.href=j.metag+this.actionItem.resource,e.download=this.actionItem.name+".mp4",e.click()}this.closeMenu()},closeMenu(){this.menuDialog.visible=!1},get renderCreateBtn(){if(this.loadingComplete)return s(u,{type:_.Primary,className:I,onClick:this.openCreateDialog,children:[t(w,{icon:D}),"Create new Project"]})},get renderCreateNoData(){if(this.loadingComplete&&!this.items.length)return t("div",{className:B,children:t("div",{className:Z,children:t(N,{description:"No Projects yet."})})})}})));return e.useEffect((()=>{f.fetchList()}),[]),s(a,{children:[t("div",{className:M,children:t("div",{children:f.renderCreateBtn})}),t(b,{show:f.loading,showMask:!1,style:{flex:1,overflow:"hidden",padding:"10px",margin:"0 -10px"},children:s("div",{className:V,children:[t("div",{className:$,children:"In Progress"}),s("div",{className:R,children:[" ",f.items.length," Projects"]}),t("div",{className:S,children:f.items.map((e=>s("div",{className:T,onClick:()=>p(`/editor?pid=${e.pid}&title=${e.title}`),children:[t("div",{className:U,children:e.details.cover&&t("img",{src:`${j.metag}${e.details.cover}`})}),t("h2",{className:L,children:e.title}),s("div",{className:A,children:[s("span",{children:["Edit ",v(e.modified_at)]}),t(w,{icon:q,onClick:t=>f.openProcessMenu(t,e)})]})]},e.pid)))}),t("div",{className:$,children:"Exported"}),t("div",{className:F,children:f.exports.map(((e,i)=>{let l,o=Math.floor(Number(e.percent)),r=!1;if((e.resource.indexOf(".wav")>-1||e.resource.indexOf(".mp3")>-1)&&(r=!0),e.resource){l=e.resource.split(".")[1]}return s("div",{className:T,onClick:()=>f.goToProview(e),children:[o>0&&100!=o?s("div",{className:H,children:[s("div",{className:O,children:[t(k,{type:"circle",percent:o,strokeColor:{"0%":"#108ee9","100%":"#87d068"},size:20})," ",e.name]}),s("div",{children:["Exporting ",e.percent,"%"]})]}):t(a,{}),s("div",{className:U,children:[e.thumbnail&&!r?t("img",{src:`${j.metag}${e.thumbnail}`}):t(a,{}),r?t("img",{src:"/assets/audio-2ef10ca8.png"}):t(a,{})]}),s("h2",{className:L,children:[e.name,l?s("span",{children:[" (",l,")"]}):t(a,{})]}),s("div",{className:A,children:[t("span",{children:v(e.created_at)}),t(w,{icon:q,onClick:t=>f.openExportMenu(t,e)})]})]},"e_"+i)}))})]})}),f.renderCreateNoData,t(X,{x:f.menuDialog.x,y:f.menuDialog.y,style:{backgroundColor:"#000",border:"3px solid #171717",borderRadius:"5px"},visible:f.menuDialog.visible,items:f.menuItems,onMenuClick:f.handlerMenuClick,onMaskClick:f.closeMenu}),s(y,{visible:f.delVisible,style:{width:"358px"},onClose:f.closeDelDialog,children:[t("header",{className:"modal__head",children:s("h2",{className:"modal__title",children:[t(w,{icon:C,fillByCurrentColor:!0}),"Delete ",f.isProgress?"Project":"Exported"]})}),t("section",{className:"modal__body",style:{textAlign:"center"},children:"Are you sure you want to delete this item ï¼Ÿ"}),s("footer",{className:"modal__foot",children:[t(u,{className:"modal__btn modal__btn-cancel",onClick:f.closeDelDialog,children:"Cancel"}),t(u,{className:"modal__btn",loading:f.delLoading,onClick:f.handlerDel,children:"Delete"})]})]}),s(y,{visible:f.createVisible,style:{width:"358px"},onClose:f.closeCreateDialog,children:[t("header",{className:"modal__head",children:t("h2",{className:"modal__title",children:"New Project"})}),s("div",{className:z,children:[t("input",{placeholder:"Please enter the project name",value:f.projectName,onChange:f.projectNameChange}),t(u,{className:W,loading:f.createLoading,onClick:f.createProject,children:"define"})]})]}),s(y,{visible:f.changeVisible,style:{width:"358px"},onClose:f.closeChangeDialog,children:[t("header",{className:"modal__head",children:s("h2",{className:"modal__title",children:["Change ",f.isProgress?"Project":"Exported"," Name"]})}),s("div",{className:z,children:[t("input",{placeholder:"Please enter name",value:f.projectName,onChange:f.projectNameChange}),t(u,{className:W,loading:f.createLoading,onClick:f.changeProject,children:"define"})]})]})]})}));export{G as default};
