import{r as e,b as t,a as i,j as s,F as a,H as r}from"./index-ec06099d.js";import{g as l,a as o,c as n,b as c,d,e as h,f as m}from"./project-48792661.js";import{o as p,u as g}from"./index-49d517ba.js";import{B as _,a as u}from"./index-bcb94e73.js";import{i as f,M as C,S as x,g as b}from"./info2-ff7c999b.js";import{f as v}from"./formatDate-e3431c7a.js";import{L as y,E as N}from"./index-4adc900e.js";import{B as j}from"./BaseUrl-9fb7060e.js";import{b as P}from"./thread-83b93477.js";import{I as w}from"./index-fa88d25c.js";import{S as D}from"./add-31d213d9.js";import{P as k}from"./progress-38585db7.js";import{m as E}from"./index-4f219f41.js";import"./request-4950b42e.js";import"./index-f246fd73.js";import"./index-0eb3c0bb.js";import"./toConsumableArray-e86c248d.js";import"./render-187aeed7.js";import"./index-96d8c866.js";import"./zoom-317aad4c.js";import"./useLayoutEffect-44a00785.js";import"./useMergedState-c32603e7.js";import"./Compact-021ea709.js";import"./KeyCode-c4e81b93.js";const M="_header_1r0zy_1",L="_title_1r0zy_10",I="_btn-create_1r0zy_24",z="_create_1r0zy_37",B="_content_1r0zy_54",V="_stateTitle_1r0zy_65",$="_exportTitle_1r0zy_75",T="_numberTitle_1r0zy_86",R="_card-list_1r0zy_96",S="_item_1r0zy_99",U="_preview_1r0zy_114",A="_bottom_1r0zy_138",F="_export-list_1r0zy_166",H="_export-status_1r0zy_177",O="_export-name_1r0zy_188",W="_banner_1r0zy_192",Z="_input-box_1r0zy_245",J="_btn_1r0zy_16",K="_empty_1r0zy_277",X="_menu__box_8b6ma_1",q="_menu__darkitem_8b6ma_25",G=i=>{const{x:s,y:a,visible:r,items:l,style:o,onMaskClick:n,onMenuClick:c}=i,d=e.useRef(null);e.useEffect((()=>{if(r){const{offsetWidth:e,offsetHeight:t}=d.current,i=20,r=e/2;let l=s-r,o=a;l-r<=0?l=0:l+e>=innerWidth-i&&(l=innerWidth-e-i),o+t>=innerHeight-i&&(o=innerHeight-t-i),d.current.style.left=l+"px",d.current.style.top=o+"px"}}),[r]);const h=e.useCallback((e=>{null==c||c(e)}),[l]);return t(f,{visible:r,onClick:n,children:t("div",{ref:d,className:X,style:o,children:l.map(((e,i)=>t("div",{className:q,onClick:()=>h(e.value),children:e.label},i)))})})};function Q(t){return e.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",fill:"none",width:14,height:14,viewBox:"0 0 14 14",...t},e.createElement("defs",null,e.createElement("clipPath",{id:"master_svg0_4547_18703"},e.createElement("rect",{x:0,y:0,width:14,height:14,rx:0}))),e.createElement("g",{style:{mixBlendMode:"passthrough"},clipPath:"url(#master_svg0_4547_18703)"},e.createElement("g",{style:{mixBlendMode:"passthrough"}},e.createElement("path",{d:"M1.75,7.0000440234375C1.75,6.3557080234375,2.272334,5.8333740234375,2.91667,5.8333740234375C3.561,5.8333740234375,4.08333,6.3557080234375,4.08333,7.0000440234375C4.08333,7.6443740234375,3.561,8.1667040234375,2.91667,8.1667040234375C2.272334,8.1667040234375,1.75,7.6443740234375,1.75,7.0000440234375C1.75,7.0000440234375,1.75,7.0000440234375,1.75,7.0000440234375ZM5.83333,7.0000440234375C5.83333,6.3557080234375,6.35567,5.8333740234375,7,5.8333740234375C7.64435,5.8333740234375,8.16667,6.3557080234375,8.16667,7.0000440234375C8.16667,7.6443740234375,7.64435,8.1667040234375,7,8.1667040234375C6.35567,8.1667040234375,5.83333,7.6443740234375,5.83333,7.0000440234375C5.83333,7.0000440234375,5.83333,7.0000440234375,5.83333,7.0000440234375ZM9.91667,7.0000440234375C9.91667,6.3557080234375,10.43898,5.8333740234375,11.08333,5.8333740234375C11.72768,5.8333740234375,12.25,6.3557080234375,12.25,7.0000440234375C12.25,7.6443740234375,11.72768,8.1667040234375,11.08333,8.1667040234375C10.43898,8.1667040234375,9.91667,7.6443740234375,9.91667,7.0000440234375C9.91667,7.0000440234375,9.91667,7.0000440234375,9.91667,7.0000440234375Z",fillRule:"evenodd",fill:"#B3BBC7",fillOpacity:1}))))}const Y=p((()=>{const p=i(),f=g((()=>({loading:!1,loadingComplete:!1,delLoading:!1,createLoading:!1,changeLoading:!1,items:[],exports:[],isProgress:!0,menuItems:[],processItems:[{label:"Rename",value:"rename"},{label:"Delete",value:"delete"}],downItems:[{label:"Rename",value:"rename"},{label:"Download",value:"download"},{label:"Delete",value:"delete"}],actionItem:null,delVisible:!1,createVisible:!1,changeVisible:!1,projectName:"",menuDialog:{x:0,y:0,visible:!1},async fetchProgressList(){this.loading=!0;const e=await l({limit:100,page:1});r((()=>{this.loadingComplete=!0,this.loading=!1,this.items=e}))},failedPrompt(){E.error("Export failed")},getFilePath(e,t){P(t).then((t=>{r((()=>{t&&t.length>0&&(e.resource=t[0].url,e.thumbnail=t[0].meta.thumbnail)}))})).catch((()=>{this.failedPrompt()})).finally((()=>{r((()=>e.loading=!1))}))},getExportProgress(e,t){e.loading=!0,e.percent=0,e.resource="",b(t,(t=>{r((()=>e.percent=t))})).then((i=>{"success"===i?this.getFilePath(e,t):(r((()=>e.loading=!1)),this.failedPrompt())})).catch((()=>{r((()=>e.loading=!1)),this.failedPrompt()}))},async fetchExportList(){const e=await o({limit:100,page:1});r((()=>{this.exports=e})),this.exports.forEach((e=>{"progress"===e.status&&this.getExportProgress(e,e.task_id)}))},async fetchList(){this.loading=!0,this.fetchProgressList(),this.fetchExportList()},async createProject(){this.createLoading=!0;const e=await n({title:this.projectName||"Unnamed"});r((()=>{this.createLoading=!1})),this.closeCreateDialog(),(null==e?void 0:e.pid)&&p(`/editor?pid=${e.pid}&title=${e.title}`)},async changeProject(){this.changeLoading=!0,this.isProgress?(await c({pid:this.actionItem.pid,title:this.projectName||"Unnamed"}),this.fetchProgressList()):(await d({export_id:this.actionItem.export_id,title:this.projectName||"Unnamed"}),this.fetchExportList()),r((()=>{this.changeLoading=!1})),this.closeChangeDialog()},projectNameChange(e){this.projectName=e.target.value},closeDelDialog(){this.delVisible=!1},openCreateDialog(){this.projectName="",this.createVisible=!0},closeCreateDialog(){this.createVisible=!1},openChangeDialog(){this.changeVisible=!0},closeChangeDialog(){this.changeVisible=!1},async handlerDel(){if(this.delLoading=!0,this.isProgress){"successed"===(await h(this.actionItem.pid)).status&&this.fetchProgressList()}else{"successed"===(await m({export_id:this.actionItem.export_id})).status&&this.fetchExportList()}r((()=>{this.delLoading=!1})),this.closeDelDialog()},openMenu(e,t){e.stopPropagation(),this.actionItem=t,f.menuDialog={x:e.clientX,y:e.clientY,visible:!0}},openProcessMenu(e,t){e.stopPropagation(),this.menuItems=[...this.processItems],this.isProgress=!0,this.openMenu(e,t)},openExportMenu(e,t){e.stopPropagation(),this.menuItems=[...this.downItems],this.isProgress=!1,this.openMenu(e,t)},goToProview(e){p(`/main/preview?eid=${e.export_id}`),window.localStorage.setItem("curExported",JSON.stringify(e))},handlerMenuClick(e){switch(e){case"delete":this.delVisible=!0;break;case"share":break;case"rename":this.projectName=this.isProgress?this.actionItem.title:this.actionItem.name,this.changeVisible=!0;break;case"download":const e=document.createElement("a");e.href=j.metag+this.actionItem.resource;let t=this.actionItem.resource.split(".")[1];e.download=this.actionItem.name+"."+t,e.click()}this.closeMenu()},closeMenu(){this.menuDialog.visible=!1},get renderCreateBtn(){if(this.loadingComplete)return s(_,{type:u.Primary,className:I,onClick:this.openCreateDialog,children:[t(w,{icon:D}),"Create new Project"]})},get renderCreateNoData(){if(this.loadingComplete&&!this.items.length)return t("div",{className:z,children:t("div",{className:K,children:t(N,{description:"No Projects yet."})})})}})));return e.useEffect((()=>{f.fetchList()}),[]),s(a,{children:[t("div",{className:M,children:t("div",{children:f.renderCreateBtn})}),t(y,{show:f.loading,showMask:!1,style:{flex:1,overflow:"hidden",padding:"10px",margin:"0 -10px"},children:s("div",{className:B,children:[t("div",{className:V,children:"In Progress"}),s("div",{className:T,children:[" ",f.items.length," Projects"]}),t("div",{className:R,children:f.items.map((e=>s("div",{className:S,onClick:()=>p(`/editor?pid=${e.pid}&title=${e.title}`),children:[t("div",{className:U,children:e.details.cover&&t("img",{src:`${j.metag}${e.details.cover}`})}),t("h2",{className:L,children:e.title}),s("div",{className:A,children:[s("span",{children:["Edit ",v(e.modified_at)]}),t(w,{icon:Q,onClick:t=>f.openProcessMenu(t,e)})]})]},e.pid)))}),t("div",{className:$,children:"Exported"}),t("div",{className:F,children:f.exports.map(((e,i)=>{let r,l=Math.floor(Number(e.percent)),o=!1;if((e.resource.indexOf(".wav")>-1||e.resource.indexOf(".mp3")>-1)&&(o=!0),e.resource){r=e.resource.split(".")[1]}return s("div",{className:S,onClick:()=>f.goToProview(e),children:[l>0&&100!=l?s("div",{className:H,children:[s("div",{className:O,children:[t(k,{type:"circle",percent:l,strokeColor:{"0%":"#108ee9","100%":"#87d068"},size:20})," ",e.name]}),s("div",{children:["Exporting ",e.percent,"%"]})]}):t(a,{}),s("div",{className:`${e.thumbnail&&!o?U:W}`,children:[e.thumbnail&&!o?t("img",{src:`${j.metag}${e.thumbnail}`}):t(a,{}),o?t("img",{src:"/assets/audio-2ef10ca8.png"}):t(a,{})]}),s("h2",{className:L,children:[e.name,r?s("span",{children:[" (",r,")"]}):t(a,{})]}),s("div",{className:A,children:[t("span",{children:v(e.created_at)}),t(w,{icon:Q,onClick:t=>f.openExportMenu(t,e)})]})]},"e_"+i)}))})]})}),f.renderCreateNoData,t(G,{x:f.menuDialog.x,y:f.menuDialog.y,style:{backgroundColor:"#000",border:"3px solid #171717",borderRadius:"5px"},visible:f.menuDialog.visible,items:f.menuItems,onMenuClick:f.handlerMenuClick,onMaskClick:f.closeMenu}),s(C,{visible:f.delVisible,style:{width:"358px"},onClose:f.closeDelDialog,children:[t("header",{className:"modal__head",children:s("h2",{className:"modal__title",children:[t(w,{icon:x,fillByCurrentColor:!0}),"Delete ",f.isProgress?"Project":"Exported"]})}),t("section",{className:"modal__body",style:{textAlign:"center"},children:"Are you sure you want to delete this item ï¼Ÿ"}),s("footer",{className:"modal__foot",children:[t(_,{className:"modal__btn modal__btn-cancel",onClick:f.closeDelDialog,children:"Cancel"}),t(_,{className:"modal__btn",loading:f.delLoading,onClick:f.handlerDel,children:"Delete"})]})]}),s(C,{visible:f.createVisible,style:{width:"358px"},onClose:f.closeCreateDialog,children:[t("header",{className:"modal__head",children:t("h2",{className:"modal__title",children:"New Project"})}),s("div",{className:Z,children:[t("input",{placeholder:"Please enter the project name",value:f.projectName,onChange:f.projectNameChange}),t(_,{className:J,loading:f.createLoading,onClick:f.createProject,children:"define"})]})]}),s(C,{visible:f.changeVisible,style:{width:"358px"},onClose:f.closeChangeDialog,children:[t("header",{className:"modal__head",children:s("h2",{className:"modal__title",children:["Change ",f.isProgress?"Project":"Exported"," Name"]})}),s("div",{className:Z,children:[t("input",{placeholder:"Please enter name",value:f.projectName,onChange:f.projectNameChange}),t(_,{className:J,loading:f.createLoading,onClick:f.changeProject,children:"define"})]})]})]})}));export{Y as default};
